"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="7abb605e-3a5e-5040-9202-e2211973f4b2")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[7981],{369463:(e,a,s)=>{s.d(a,{Ay:()=>h,DA:()=>x,DD:()=>l,IC:()=>m,Jm:()=>n,MV:()=>c,O2:()=>u,QW:()=>_,Vz:()=>d,dd:()=>r,eX:()=>i,fH:()=>f,hL:()=>v,ho:()=>o,ns:()=>j,rf:()=>t});let l="autosave_modal--title--1ahIU",t="autosave_modal--body--v9I-T",n="autosave_modal--openFilesToSyncText--jzS-z",i="autosave_modal--fileRows--Xo29r",o="autosave_modal--fileRow--G71rM",r="autosave_modal--userRows--gF1fc",d="autosave_modal--onlyFileRow--gRn-- autosave_modal--fileRow--G71rM autosave_modal--body--v9I-T",c="autosave_modal--onlyFileRowText--ewASS",u="autosave_modal--userTitle--vam8h ellipsis--ellipsis--70pHK text--fontPos11--rO47d text--_fontBase--VaHfk",h="autosave_modal--fileMetadata--ZOxoq",x="autosave_modal--fileTitle--vCMuE ellipsis--ellipsis--70pHK",v="autosave_modal--fileLastUpdatedAt--QmxMQ ellipsis--ellipsis--70pHK text--fontPos11--rO47d text--_fontBase--VaHfk",f="autosave_modal--expiryWrapper--QJUmJ",m="autosave_modal--expiry--U-mdR",_="autosave_modal--warningIcon--FuQIV",j="autosave_modal--openToSync--jggEA"},285078:(e,a,s)=>{s.r(a),s.d(a,{AutosaveLearnMoreModal:()=>c});var l=s(239976),t=s(245814),n=s(942356),i=s(655793),o=s(517478),r=s(379141),d=s(369463);function c(e){let a=t.hS({open:e.open,onClose:e.onClose}),s=(0,l.jsx)(n.$n,{variant:"secondary",onClick:e.onClose,children:(0,r.tx)("autosave.learn_more.done_button")});return(0,l.jsx)(i.bL,{manager:a,width:"lg",children:(0,l.jsxs)(o.vo,{children:[(0,l.jsx)(o.Y9,{children:(0,l.jsx)(o.hE,{children:(0,r.tx)("autosave.learn_more.title")})}),(0,l.jsxs)(o.nB,{children:[(0,l.jsx)("div",{children:(0,r.tx)("autosave.learn_more.body_save_pending_changes")}),(0,l.jsx)("div",{className:d.rf,children:(0,r.tx)("autosave.learn_more.body_use_version_history")})]}),(0,l.jsx)(o.wi,{children:(0,l.jsx)(o.jk,{children:s})})]})})}},295625:(e,a,s)=>{s.r(a),s.d(a,{AutosaveLogOutModal:()=>X,HasAutosaveChangesModal:()=>Q});var l=s(239976),t=s(105652),n=s(20002),i=s(787049),o=s(60021),r=s(295870),d=s(942356),c=s(655793),u=s(517478),h=s(245814),x=s(379141),v=s(882268),f=s.n(v),m=s(732838),_=s(141288),j=s(129416),g=s(19047),y=s(297094),p=s(259714),b=s(620132),w=s(555512),A=s(955098),N=s(154963),C=s(62440),k=s(536378),F=s(760898),S=s(801566),O=s(719263),D=s(210760),L=s(605985),M=s(394396),E=s(773444),T=s(434402),$=s(702417),U=s(737473),R=s(369463),I=s(35401);function B(e){return e.user?(0,l.jsx)("div",{className:R.O2,children:(0,l.jsx)("p",{children:e.user.community_profile_handle||e.user.email})}):null}async function H(e,a){let s=!1,l=null;try{let{data:t}=await U.S.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=t.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(s=!0)}catch(e){404===e.status?s=!0:(0,g.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:s,unsyncedFile:a,figFile:l}}let K=(e,a)=>(0,o.s)(()=>{let s=new URL((0,M.r1)(E.F.toLiveGraph(e),!0));s.searchParams.append("fuid",a),_.Ay.redirect(s.toString(),"_blank")}),G=(e,a)=>(0,o.s)(()=>e(C.NA({file:a,openNewFileIn:$.ai.NEW_TAB,source:T.U.AUTOSAVE_MODAL}))),V=A.y.SMALL;function P(e,a,s){return(0,O.y8)(a)?{fileName:a.file.name,onClick:K(a.file,s.id),thumbnail:(0,l.jsx)(b.NU,{file:a.file,size:V,borderRadius:4})}:{fileName:a.name,onClick:G(e,a),thumbnail:(0,l.jsx)(w.A,{size:V,borderRadius:4})}}function W(e){let{fileName:a,onClick:s,thumbnail:t}=P((0,n.wA)(),e.fileState,e.user);return(0,l.jsxs)("div",{className:R.ho,children:[(0,l.jsx)("div",{className:N.s.hFull.$,children:t}),(0,l.jsxs)("div",{className:R.Ay,children:[(0,l.jsx)("div",{className:R.DA,children:a}),(0,l.jsx)("div",{className:R.hL,children:(0,x.tx)("tile.file_tile.edited_time",{time:(0,l.jsx)(y.h1,{date:e.fileState.lastUpdatedAt})})})]}),(0,l.jsx)("div",{className:R.ns,children:(0,l.jsx)(d.$n,{variant:"secondary",onClick:s,children:(0,x.tx)("autosave.has_changes.open_to_sync")})})]},e.fileState.fileKey)}function Y(e){return(0,l.jsx)("div",{className:R.dd,children:Object.keys(e.files).map(a=>(0,l.jsxs)("div",{className:R.eX,children:[(0,l.jsx)(B,{user:e.users.filter(e=>e?.id===a)[0]}),(0,l.jsx)("div",{children:Object.values(e.files[a]).map(s=>(0,l.jsx)(W,{fileState:s,user:e.users.filter(e=>e?.id===a)[0]},s.fileKey))})]},a))})}function z({modalManager:e,files:a,nextGarbageCollectionTimestamp:s,users:t,includeDismissButton:i,onDone:o}){let r;let h=(0,n.wA)(),v=o||(()=>{h(k.Ce())}),m=Z(s),_=(0,x.tx)("autosave.has_changes.sync_offline_changes"),j=1===f()(Object.values(a)).length,g=null,y=null,b=null,w=null,A=null;if(j){g=f()(Object.values(a))[0];let e=Object.keys(a).filter(e=>a[e].length>0)[0],s=P(h,g,y=t.filter(a=>a?.id===e)[0]);b=s.fileName,w=s.onClick,A=s.thumbnail,r=(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(B,{user:y}),(0,l.jsxs)("div",{className:R.Vz,children:[(0,l.jsx)("div",{className:N.s.hFull.$,children:A}),(0,l.jsx)("div",{className:R.MV,children:(0,x.tx)("autosave.has_changes.unsaved_changes_to_file",{fileName:(0,l.jsx)("span",{className:R.DD,children:b})})})]})]})}else r=(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:R.Jm,children:(0,x.tx)("autosave.has_changes.unsynced_changes_offline")}),(0,l.jsx)(Y,{files:a,users:t})]});let C=m&&(0,l.jsxs)("div",{className:R.fH,children:[(0,l.jsx)(p.B,{svg:I.A,className:R.QW}),(0,l.jsx)("div",{className:R.IC,children:m})]}),F=i&&(0,l.jsx)(d.$n,{variant:"secondary",onClick:v,children:(0,x.tx)("autosave.has_changes.dismiss.later")}),S=j&&w&&(0,l.jsx)(d.$n,{variant:"primary",onClick:w,children:(0,x.tx)("autosave.has_changes.open_to_sync")});return(0,l.jsx)(c.bL,{manager:e,width:"lg",children:(0,l.jsxs)(u.vo,{children:[(0,l.jsx)(u.Y9,{children:(0,l.jsx)(u.hE,{children:_})}),(0,l.jsx)(u.nB,{children:r}),(C||F||S)&&(0,l.jsxs)(u.wi,{children:[C,(F||S)&&(0,l.jsxs)(u.jk,{children:[F,S]})]})]})})}function Q(e){let a=h.hS({open:e.open,onClose:e.onClose}),{unsyncedFiles:s,localUnsyncedFiles:t}=(0,F.Gg)(),i=(0,n.d4)(e=>e.modalShown),o=(0,n.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),r=(0,L.iZ)(),d=r?.id;return i&&d&&r?(0,l.jsx)(z,{modalManager:a,files:{[d]:[...s,...t]},nextGarbageCollectionTimestamp:o,users:[r],includeDismissButton:!0}):null}function J(e){let a=h.hS({open:e.open,onClose:e.onClose}),s=(0,n.wA)(),[i,o]=t.useState(!1),[r,v]=t.useState(!1),f=async()=>{try{for(let a of e.users){let e=a?.id;e&&await (0,F.go)((0,S.cu)(e))}}finally{v(!0)}},_=()=>{o(!0)},j=0===Object.values(e.files).length;if(r||j&&e.loaded){let s=(0,x.tx)("autosave.logout.offline_changes"),t=r?(0,x.tx)("autosave.logout.offline_changes_discarded"):(0,x.tx)("autosave.logout.offline_changes_synced"),n=(0,l.jsx)(d.$n,{variant:"secondary",onClick:e.onLogOut,children:(0,x.tx)("autosave.logout.log_out")});return(0,l.jsx)(c.bL,{width:"md",manager:a,children:(0,l.jsxs)(u.vo,{children:[(0,l.jsx)(u.Y9,{children:(0,l.jsx)(u.hE,{children:s})}),(0,l.jsx)(u.nB,{children:t}),(0,l.jsx)(u.wi,{children:(0,l.jsx)(u.jk,{children:n})})]})})}if(i)return(0,l.jsx)(z,{...e,modalManager:a,onDone:()=>{o(!1)}});{let t,n,i;let o=(0,x.tx)("autosave.has_changes.sync_offline_changes"),r=m.eD?(0,x.t)("autosave.logout.log_out_text.desktop"):(0,x.t)("autosave.logout.log_out_text.web");return m.eD?(t=(0,l.jsx)(d.$n,{variant:"destructiveSecondary",onClick:f,children:(0,x.tx)("autosave.logout.discard_and_logout")}),n=(0,l.jsx)(d.$n,{variant:"secondary",onClick:()=>{s(k.Lo())},children:(0,x.tx)("autosave.logout.cancel")}),i=(0,l.jsx)(d.$n,{variant:"secondary",onClick:_,children:(0,x.tx)("autosave.logout.show_changes")})):(t=(0,l.jsx)(d.$n,{variant:"destructiveSecondary",onClick:f,children:(0,x.tx)("autosave.logout.discard")}),n=(0,l.jsx)(d.$n,{variant:"secondary",onClick:e.onLogOut,children:(0,x.tx)("autosave.logout.log_out")}),i=(0,l.jsx)(d.$n,{variant:"primary",onClick:_,children:(0,x.tx)("autosave.logout.sync_changes")})),(0,l.jsx)(c.bL,{manager:a,width:"lg",children:(0,l.jsxs)(u.vo,{children:[(0,l.jsx)(u.Y9,{children:(0,l.jsx)(u.hE,{children:o})}),(0,l.jsx)(u.nB,{children:r}),(0,l.jsxs)(u.wi,{children:[t,(0,l.jsxs)(u.jk,{children:[n,i]})]})]})})}}function X(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:s,loaded:o,autosaveFilesToDelete:d}=function(e){let a=(0,n.wA)(),[s,l]=t.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return t.useEffect(()=>{let a=async()=>{try{let a=await (0,F.ZW)((0,i.WI)(e.map(e=>e?.id))),s={},t=[],n=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)n.push(H(e,a));for(let a of l.newFiles)e in s||(s[e]=[]),s[e].push(a)}for(let e of(await Promise.all(n))){let a=e.userID;e.shouldDeleteFile?t.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in s||(s[a]=[]),s[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let o=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));l({multiUserGarbageCollectionTimestamp:o,multiUserUnsyncedFiles:s,loaded:!0,autosaveFilesToDelete:t})}catch(e){e instanceof Error?((0,g.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,j.$D)(r.e.SCENEGRAPH_AND_SYNC,e)):(0,j.$D)(r.e.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return D.hp.register(D.a,a),a(),function(){D.hp.unregister(D.a,a)}},[a,e]),s}(e.users);return(0,L.TA)()?(0,l.jsx)(J,{...e,loaded:o,nextGarbageCollectionTimestamp:s,files:a,onLogOut:()=>{for(let e of d)(0,F.go)((0,S.Zt)(e.userID,e.fileKey)).catch(e=>{(0,j.$D)(r.e.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}Q.displayName="HasAutosaveChangesModal";let Z=e=>{let a=Math.floor(((0,F.bD)()-(Date.now()-e))/864e5);return a>5?null:a<1?(0,x.tx)("autosave.has_changes.expiry_text_shortly"):(0,x.tx)("autosave.has_changes.expiry_text_days",{days:a})};X.displayName="AutosaveLogOutModal"},625245:(e,a,s)=>{s.r(a),s.d(a,{AutosaveNewFileAlreadyOpenModal:()=>v});var l=s(239976),t=s(105652),n=s(20002),i=s(245814),o=s(655793),r=s(517478),d=s(942356),c=s(379141),u=s(522568),h=s(154963),x=s(536378);function v(e){let a=(0,n.wA)();(0,t.useEffect)(()=>(0,u.sx)("New Autosave File Already Open Modal Shown"));let s=()=>a(x.Ce()),v=i.hS({open:!0,onClose:s});return(0,l.jsx)(o.bL,{manager:v,width:360,children:(0,l.jsxs)(r.vo,{children:[(0,l.jsx)(r.Y9,{children:(0,l.jsx)(r.hE,{children:(0,c.tx)("autosave.file_already_open_modal.title")})}),(0,l.jsx)(r.nB,{children:(0,c.tx)("autosave.file_already_open_modal.body",{fileName:(0,l.jsx)("span",{className:h.s.fontSemiBold.$,children:e.file.name})})}),(0,l.jsx)(r.wi,{children:(0,l.jsx)(r.jk,{children:(0,l.jsx)(d.$n,{variant:"secondary",onClick:s,children:(0,c.tx)("general.ok")})})})]})})}v.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=7abb605e-3a5e-5040-9202-e2211973f4b2

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/70038d2b311302ce21c1af1f578dc64ca576cc8c/1a115cee-40b7385aa5e62567.min.js.map
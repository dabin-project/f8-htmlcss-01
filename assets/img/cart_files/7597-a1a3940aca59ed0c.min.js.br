"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d9bc37d5-c94a-5843-ae12-c08c65630549")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[7597],{97597:(e,t,n)=>{n.r(t),n.d(t,{CommentsSubmitButton:()=>es,ThreadCommentComposer:()=>eu,getUploadErrorMessage:()=>eo});var r=n(239976),l=n(105652),i=n(20002),s=n(836848),o=n(378721),u=n(942356),a=n(289457),d=n(319192);let c=(0,l.memo)(function(e){return(0,r.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,"data-fpl-icon-size":"24",children:(0,r.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",d:"M11.655 5.008q.345-.015.689 0 .06.003.12.01.12.006.24.018l.103.011a7 7 0 0 1 .475.072l.064.011q.145.03.287.063l.044.01q.126.031.252.068l.092.026.19.06.146.05q.078.028.154.058.093.036.185.074l.11.047.184.083.15.075.168.087.098.054q.1.054.197.113.062.038.123.078.08.049.16.101l.1.07.19.135.115.09q.068.052.136.107.087.071.17.145l.097.083q.098.09.192.182l.064.061.354.354a.5.5 0 0 1 .097.143A6.97 6.97 0 0 1 19 12.001v.5l-.013.254a2.497 2.497 0 0 1-4.608 1.065A3 3 0 0 1 12 15a3 3 0 0 1 0-6c.77 0 1.47.292 2 .768V9.5a.5.5 0 0 1 1 0v3a1.5 1.5 0 0 0 2.993.154L18 12.5V12a6 6 0 0 0-11.97-.596q-.009.092-.015.184a6 6 0 0 0 .014 1.007q.039.384.127.76a6 6 0 0 0 1.774 3.052A5.98 5.98 0 0 0 12 18a5.98 5.98 0 0 0 4.243-1.757.5.5 0 0 1 .707.707 6.98 6.98 0 0 1-5.294 2.04q-.096-.004-.191-.013l-.149-.01q-.102-.011-.204-.025l-.142-.019-.232-.039-.092-.016q-.107-.021-.215-.047l-.131-.03-.2-.054-.13-.037-.175-.057-.153-.05-.16-.061-.17-.068-.14-.061-.164-.074-.12-.06a7 7 0 0 1-.214-.11q-.026-.013-.05-.028a7 7 0 0 1-.23-.13q-.05-.03-.1-.063-.24-.15-.471-.32l-.114-.09q-.077-.058-.153-.12l-.113-.097q-.082-.07-.162-.142a7 7 0 0 1-.465-.465q-.07-.078-.137-.158l-.091-.107a7 7 0 0 1-.155-.196l-.051-.068a7 7 0 0 1-.143-.199l-.055-.078a7 7 0 0 1-.29-.477l-.065-.115-.1-.195-.058-.12-.075-.164-.061-.14a7 7 0 0 1-.135-.352l-.05-.148-.046-.143-.05-.177-.045-.165q-.024-.1-.046-.203-.016-.06-.027-.123-.023-.115-.04-.23l-.02-.115-.023-.177-.02-.169a7 7 0 0 1 0-1.368q.012-.116.028-.23.006-.058.014-.115.014-.09.031-.181l.029-.163q.017-.09.039-.177.016-.077.035-.154l.045-.165a7 7 0 0 1 .096-.32l.057-.17.064-.168.064-.162q.036-.087.076-.172l.06-.133q.008-.021.02-.042l.11-.22.028-.052q.031-.058.064-.115.052-.093.106-.183l.087-.138q.045-.074.093-.146.057-.083.116-.165l.087-.122q.035-.048.072-.094.067-.087.136-.17.065-.08.132-.156.095-.108.194-.212.182-.196.379-.375.074-.067.15-.13l.115-.1q.094-.075.19-.147l.072-.057q.1-.074.201-.143l.08-.056q.09-.059.18-.115l.087-.056.073-.044.14-.079.108-.06q.084-.045.17-.086l.15-.076.162-.072.14-.061q.083-.036.17-.068l.16-.06.152-.051q.087-.03.175-.057l.114-.032a7 7 0 0 1 .239-.064l.046-.011q.138-.033.28-.06.045-.01.089-.017l.23-.04.229-.028.098-.011q.12-.012.239-.019zM12 10.001a2 2 0 1 0 0 4 2 2 0 0 0 0-4"})})});var p=n(418379),f=n(379141),m=n(270450),g=n(445019),h=n(224542),_=n.n(h),x=n(128146),y=n(522568),b=n(312884),k=n(309742),v=n(7857),C=n(369134),T=n(499735),E=n(875253),A=n(687934),I=n(782569),D=n(888903),S=n(136393),j=n(304315),w=n(650008),N=n(536378),F=n(639758),M=n(320241),O=n(408823),L=n(131464);function P(e){let t=(0,i.wA)(),{attachments:n}=e,l=e=>{t((0,N.to)({type:M.q,data:{attachments:n,selectedIdx:n.map(e=>e.thumbnailUrl).indexOf(e),onUpdateAltText:s,canEdit:!0}}))},s=(t,r)=>{let l=n[r];return e.fileKey?F.l.put(e.fileKey,l.id,t).then(n=>(200===n.status&&e.onUpdate({...l,altText:t}),n)):Promise.resolve(void 0)};return(0,r.jsxs)("div",{className:L.kG,onClick:e.focusComposer,children:[0===n.length&&e.renderPlaceholderAttachment&&(0,r.jsx)(O.NO,{}),n.map(t=>(0,r.jsx)(O.vi,{thumbnailUrl:t.thumbnailUrl,altText:(0,f.t)("comments.attachment_thumbnail_alt_text_default"),onClick:l,isUploading:t.isUploading,onDelete:()=>e.onDelete(t)},t.id))]})}var R=n(388681),q=n(193507),K=n(393822),U=n(201436),J=n(227910),W=n(562418),G=n(720410),X=n(526575),$=n(566697),z=n(223487),B=n(605985),H=n(748181),Z=n(920675),Y=n(814518),V=n(750514),Q=n(415315),ee=n(236410),et=n(684993),en=n(988223),er=n(327559),el=n(682950);let ei=[];function es(e){let t=(0,f.t)("comments.submit");return(0,r.jsx)(o.K,{recordingKey:T.Pt(e,"submit"),disabled:e.disabled,onClick:e.onClick,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":t,"aria-label":t,"data-testid":"comments-submit-button",variant:"primaryCircle",children:(0,r.jsx)(a.G,{})})}let eo=e=>{switch(e.type){case Q.Wn.MAX_UPLOADS_EXCEEDED:return(0,f.t)("comments.upload_error.media_file_maximum",e.params);case Q.Wn.MAX_IMAGE_SIZE_EXCEEDED:case Q.Wn.MAX_VIDEO_SIZE_EXCEEDED:return(0,f.t)("comments.upload_error.media_file_size_limit_MB",e.params);case Q.Wn.INVALID_FILE_TYPE:return(0,f.t)("comments.upload_error.media_file_types");case Q.Wn.DUPLICATE_FILE_UPLOAD:return(0,f.t)("comments.upload_error.already_uploaded_items",e.params);case Q.Wn.FAILED_TO_UPLOAD:return(0,f.t)("comments.upload_error.failed_to_upload",e.params);default:(0,s.xb)(e)}};function eu(e){return(0,r.jsx)(v.u9,{label:"ThreadCommentComposer",children:(0,r.jsx)(ea,{...e})})}function ea(e){let[t,n]=l.useState(e.mountInputFocused||e.mountWithButtons||!1),[s,a]=l.useState(!1),h=l.useRef(null),v=l.useRef(null),N=(0,B.iZ)(),F=(0,H.f)("has_opened_comments_modal"),{threadPosition:M,dispatch:O,viewportPositionFromClientPosition:L,setHyperlinkLocation:eu,setHyperlinkEditorRef:ea,editorRef:ed,scrollToBottom:ec}=e,ep=(0,z.q5)(),ef=ep?.key||null,em=(0,i.d4)(e=>e.currentUserOrgId),eg=ep?.teamId,eh=(0,i.d4)(e=>e.orgUsersByOrgId),e_=(0,er.i)(),ex=(0,i.d4)(e=>e.comments.editingComment),ey=(0,W.lg)(),eb=(0,W.HW)(),ek=(0,i.d4)(e=>e.comments.activeDragTarget),ev=l.useCallback(e=>{if(eu&&ea){if(e?.top===0&&e?.bottom===0&&e?.left===0&&e?.right===0&&e?.height===0&&e?.width===0&&v.current){let e=(0,b.E)(v.current.getBoundingClientRect());eu({...e,width:32,top:e.top+12})}else eu(e);ea(ed)}},[eu,ea,ed]),eC=(0,i.Pj)();l.useEffect(()=>{let t=!(0,K.eR)(e.threadId);(0,X.uE)("Comment composer opened",eC.getState(),{isThread:t}),F||eC.dispatch(S.b({has_opened_comments_modal:!0}))},[eC,e.threadId,F]);let eT=(0,i.d4)(e=>e.comments.emojiPicker),eE=l.useCallback(()=>eT?.visible?(eT.onCancel?.(),O(j.RI({visible:!1})),!0):(e.editorRef.current&&e.editorRef.current.handleEscape(),!1),[e.editorRef,eT,O]),eA=l.useCallback(()=>{e.editorRef.current&&e.editorRef.current.onFocus()},[e.editorRef]),eI=()=>{eY()||e.onSubmit()},eD=e=>{e.preventDefault(),eI()},eS=()=>{!1!==e.onCancel()&&n(!1)},ej=l.useCallback(e=>{ec&&(e?setTimeout(ec,e):ec())},[ec]);(0,k.h)(()=>{e.scrollToBottom&&v.current&&new MutationObserver(e.scrollToBottom).observe(v.current,{childList:!0,subtree:!0})});let ew=()=>{if(!M||!v.current)return;let e=v.current.getBoundingClientRect(),t=L(new E.Mi(e.right,e.top)),n=L(new E.Mi(e.left,e.bottom));O(j.i4({top:t.y-M.y,right:t.x-M.x,bottom:n.y-M.y,left:n.x-M.x,height:e.height,width:e.width}))},eN=T.qP(e.recordingKey,"update",([t,n])=>{n&&!eV(e.messageMeta)&&ej(100),e.updateMessage(t)}),eF=T.qP(e.recordingKey,"emojiPick",t=>{if(e.editorRef&&e.editorRef.current){let n=x.dN.get(t.id);n&&e.editorRef.current.insertEmoji(n),e.dispatch(j.RI({visible:!1}))}}),eM=async()=>{e.dispatch(j.We(await (0,V.fG)("",e.mentionables,ey===Z._Y.DESIGN))),(0,y.sx)("Comment Composer At Mention Clicked",{userId:e.user.id,fileKey:e.fileKey,parentCommentId:e.threadId}),ew(),a(!0),setTimeout(()=>{a(!1)},250),e.editorRef.current?.focus(!1)},eO=e.allowAttachments,{updateAttachment:eL,deleteAttachment:eP}=e,eR=e.attachments?.sort((e,t)=>e.uploadedAt.getTime()-t.uploadedAt.getTime())??ei,[eq,eK]=l.useState(eR.length),[eU,eJ]=l.useState({}),eW=eR.some(e=>e.isUploading),eG=l.useRef(null),eX=eO&&eL&&(e.renderPlaceholderAttachment||eR.length>0),e$=l.useCallback(e=>{eK(e=>e-1),eU.hasOwnProperty(e.id)?eP&&eP(e.id,eU[e.id]):eP&&eP(e.id)},[eP,eU]),ez=l.useCallback((e,t)=>{if(e instanceof C.qW){(0,en.MZ)(O,(0,f.t)("check_network_compatibility.error_bell.comment_attachments.message"));return}O(D.F.enqueue({message:eo(e)})),t&&e$(t)},[O,e$]);l.useEffect(()=>{eR.length>w.xS&&(eR.slice(w.xS).forEach(e=>{e$(e)}),ez({type:Q.Wn.MAX_UPLOADS_EXCEEDED,params:{maxNum:w.xS}}))},[eR,eq,ez,e$]);let eB=l.useCallback(t=>{if(!eO||!eL||0===t.length)return;let n=(0,Y.K)(t,eq,w.xS,Q.xp,ez);eK(e=>e+n.length),n.forEach((t,n)=>{if(Q.xp.includes(t.type)){let r=URL.createObjectURL(t),l=new Date;l.setMilliseconds(l.getMilliseconds()+n),(0,w.JZ)(e.recordingKey,eL,eJ,ez,r,t.type,ef,l,t.name||null)}else throw Error("unexpected file type")})},[eO,eL,eq,ez,e.recordingKey,ef]),eH=l.useCallback(e=>()=>{let t=e.current?.files||null;if(null===t||0===t.length)return;let n=Array.from(t);(0,y.sx)("Comment Attachments Selected",{count:n.length,fileTypes:Array.from(n.reduce((e,t)=>(e.add(t.type),e),new Set))}),eB(n),e.current&&(e.current.value="")},[eB]),eZ=(0,G.k)(),eY=()=>e.isDisabled||eW||eV(e.messageMeta)||(0,q.q)(e.messageMeta)||eZ,eV=e=>(0,q.I)(e),eQ=eY(),e0=eV(e.messageMeta)&&(!eO||0===eR.length),e1=(0,g.md)(et.p),e2=eO&&ek===e.recordingKey&&!(0,K.eR)(e.threadId),e5=(0,m.kc)().comments_lexical?J.k:U.iX;return(0,r.jsxs)(A.Y,{className:_()(e.containerClassName||{[el.fP]:!0,[el.U0]:(0,K.eR)(e.threadId),[el.mr]:e2},e0&&el.Sg),isDragTarget:()=>eO,onTargetDrop:e=>{if(e.files.length>0){let t=Array.from(e.files);(0,y.sx)("Comment Attachments Dropped",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),eB(t)}O(j.uz(null))},onTargetDragEnter:t=>{O(j.uz(e.recordingKey))},onTargetDragLeave:e=>{O(j.uz(null))},forwardedRef:v,"data-testid":e.editingExistingComment?"edit-comment-composer-container":"new-comment-composer-container",children:[(0,r.jsx)($.$W,{handleEscape:eE,priority:$.KD.EDITING_TEXT_FIELD,children:(0,r.jsx)(e5,{ref:e.editorRef,activeMentionsId:e1,ariaLabel:e.ariaLabel,className:e.editableTypeaheadClassName||el.OX,currentOrgId:em,currentOrgUsers:eh,delegateEscapeHandling:!0,dispatch:e.dispatch,editingComment:ex??void 0,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:e.editorRef,editorType:e.editorType,figmaEditorType:ey,hyperlinkLocation:e.hyperlinkLocation,initMention:s,isProtoView:eb,isThreadCommentOverflowMenuOpen:e_,maintainSelectionOnFocus:e.maintainSelectionOnFocus,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,messageMeta:e.messageMeta,mountInputFocused:e.mountInputFocused,onCancel:eS,onFilePaste:e=>{if(e.length>0){let t=e.map(e=>new File([e],"",{type:e.type}));(0,y.sx)("Comment Attachments Pasted",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),eB(t)}},onFocus:()=>{e.onComposeFocus&&e.onComposeFocus(),!t&&(n(!0),e.onEditStart&&e.onEditStart())},onSubmit:eI,onUpdateTextArea:ew,openFileKey:ef,openFileTeamId:eg,placeholderText:e.placeholderText,readOnly:e.readOnly,setHyperlinkEditorRef:ea,setHyperlinkLocation:ev,setIsEditorFocused:e.setIsEditorFocused,submitOnEnter:e.submitOnEnter??!0,typeahead:e.typeahead,updateMessage:eN,user:N})}),eX&&(0,r.jsx)(P,{attachments:eR,fileKey:ef,onDelete:e$,onUpdate:eL,focusComposer:eA,renderPlaceholderAttachment:e.renderPlaceholderAttachment}),(0,r.jsxs)("div",{className:el.o1,children:[!e0&&(0,r.jsxs)("div",{className:el.xu,children:[R.Y&&(0,r.jsx)(o.K,{onClick:t=>{(0,y.sx)("Emoji Picker Opened");let n=h.current?.getBoundingClientRect();n&&e.dispatch(j.RI({visible:!0,targetRect:n,onPick:t=>{eF(t),e.editorRef.current?.focus()},onCancel:()=>{e.editorRef.current?.focus(),e.dispatch(j.RI({visible:!1}))}}))},ref:h,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":(0,f.t)("comments.add_emoji"),"aria-label":(0,f.t)("comments.add_emoji"),"data-testid":"emoji-picker-button",recordingKey:"emojiPicker",disabled:e0,children:(0,r.jsx)(d.A,{})}),(0,r.jsx)(o.K,{onClick:eM,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":(0,f.t)("comments.add_mention"),"aria-label":(0,f.t)("comments.add_mention"),disabled:e0,recordingKey:"mentionButton",children:(0,r.jsx)(c,{})}),eO&&(0,r.jsx)(I.n,{svgAltText:(0,f.t)("comments.upload_images"),isDisabled:eR.length>=w.xS,acceptedFileTypes:Q.xp.join(","),inputRef:eG,inputId:`fileUploadIconInput-${e.recordingKey}`,onFileInputChange:eH,"data-tooltip-type":ee.Ib.TEXT,"data-tooltip":(0,f.t)("comments.upload_images"),children:(0,r.jsx)("span",{"aria-hidden":!0,children:(0,r.jsx)(p.T,{})})})]}),!e.hideSubmitButton&&(e.editingExistingComment?(0,r.jsxs)("div",{className:el.q9,children:[(0,r.jsx)(u.$n,{variant:"secondary",onClick:eS,children:(0,f.tx)("comments.cancel")}),(0,r.jsx)(u.$n,{variant:"primary",onClick:eD,disabled:eQ,recordingKey:T.Pt(e,"editSave"),children:e.submitText})]}):(0,r.jsx)(es,{recordingKey:e.recordingKey,onClick:eD,disabled:eQ}))]})]})}},227910:(e,t,n)=>{n.d(t,{k:()=>e3});var r=n(239976),l=n(105652),i=n(429921),s=n(451240),o=n(344810),u=n(618295),a=n(424178),d=n(142943),c=n(694339),p=n(899519),f=n(310634),m=n(747279),g=n(270450),h=n(323264),_=n(575015),x=n(224542),y=n.n(x),b=n(943866),k=n(938892),v=n(551492),C=n(304315),T=n(126278),E=n(796478),A=n(732838),I=n(420475),D=n(96295),S=n(600643),j=n(236410),w=n(198070);class N extends I.k_{static getType(){return"custom-auto-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new N(e.__url,{isUnlinked:e.__isUnlinked,rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=w.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-testid",`implicit-hyperlink-${this.__url}`),e.setAttribute("data-tooltip",j.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","false"),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-type",j.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:l,isUnlinked:i,editorType:s}=e;return F(t,{rel:n,target:r,title:l,isUnlinked:i,editorType:s})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-auto-link"}}}function F(e,t={}){return(0,S.pT)(new N(e,t))}class M extends S.Ey{static getType(){return"emoji"}static clone(e){return new M(e.__text,e.__shortcode,e.__key)}constructor(e,t,n){super(e,n),this.__shortcode=t}getUnicode(){return this.__text}getShortcode(){return this.__shortcode}createDOM(e){let t=super.createDOM(e);return t.className=h.Ay.classNames(L.emoji)??"",t.setAttribute("spellcheck","false"),t}updateDOM(){return!1}static importJSON(e){let{text:t,shortcode:n}=e;return O(t,n)}exportJSON(){return{...super.exportJSON(),type:"emoji",shortcode:this.__shortcode,version:1}}isSegmented(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}isTextEntity(){return!0}}function O(e,t){return new M(e,t)}let L={emoji:{kMv6JI:"x1c6ngcr",$$css:!0}};class P extends I.Db{static getType(){return"custom-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new P(e.__url,{rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=w.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-tooltip",j.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","true"),e.setAttribute("data-tooltip-entity-key",this.getKey()),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-target-ref-key",this.editorType??""),e.setAttribute("data-tooltip-type",j.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:l,editorType:i}=e;return R(t,{rel:n,target:r,title:l,editorType:i})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-link"}}static importDOM(){return{a:e=>{let t=e.getAttribute("data-tooltip-url-string");return t?{conversion:e=>{var n;return{node:R(t,{rel:(n=e).getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")})}},priority:2}:null}}}}function R(e,t={}){return(0,S.pT)(new P(e,t))}function q(e){return e instanceof P}var K=n(137823);class U extends S.Ey{static getType(){return"mention"}static clone(e){return new U(e.__text,e.__userId,e.__profileId,e.__userAnnotated,e.__userGroupId,e.__userGroup,e.__key)}constructor(e,t,n,r,l,i,s){super(e,s),this.__userId=t,this.__profileId=n,this.__userAnnotated=r,(0,g.kc)().user_groups_at_mentions&&(this.__userGroupId=l,this.__userGroup=i)}static importJSON(e){let{userId:t,profileId:n,userAnnotated:r,text:l,userGroupId:i,userGroup:s}=e;return W({displayText:l,userId:t,profileId:n,userAnnotated:r,userGroupId:(0,g.kc)().user_groups_at_mentions?i:void 0,userGroup:(0,g.kc)().user_groups_at_mentions?s:void 0})}exportJSON(){return{...super.exportJSON(),userId:this.__userId,profileId:this.__profileId,userAnnotated:this.__userAnnotated,userGroupId:(0,g.kc)().user_groups_at_mentions?this.__userGroupId:void 0,userGroup:(0,g.kc)().user_groups_at_mentions?this.__userGroup:void 0,type:"mention"}}createDOM(e){let t=super.createDOM(e);return t.className=w.lE,t.setAttribute("spellcheck","false"),this.__userId&&t.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&t.setAttribute("data-mention-profile-id",this.__profileId),this.__userGroupId&&t.setAttribute("data-mention-user-group-id",this.__userGroupId),t}exportDOM(){let e=document.createElement("a");return e.setAttribute("data-lexical-mention","true"),this.__userId&&e.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&e.setAttribute("data-mention-profile-id",this.__profileId),this.__userGroupId&&e.setAttribute("data-mention-user-group-id",this.__userGroupId),e.textContent=this.__text,{element:e}}static importDOM(){return{a:e=>e.hasAttribute("data-mention-user-id")||e.hasAttribute("data-mention-profile-id")||e.hasAttribute("data-mention-user-group-id")?{conversion:J,priority:3}:null}}isToken(){return!0}isTextEntity(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}getUserId(){return this.__userId}getProfileId(){return this.__profileId}getUserAnnotated(){return this.__userAnnotated}getUserGroupId(){return this.__userGroupId}getUserGroup(){return this.__userGroup}getMessageMetaText(){return this.getProfileId()&&this.getDisplayText().startsWith("@")?this.getDisplayText().slice(1):this.getDisplayText()}getDisplayText(){return this.__text}}function J(e){let t=e.getAttribute("data-mention-user-id")??void 0,n=e.getAttribute("data-mention-profile-id")??void 0,r=e.getAttribute("data-mention-user-group-id")??void 0,l=e.textContent??"";return{node:W({displayText:l,userId:t,profileId:n,userAnnotated:t?{id:t,img_url:e.getAttribute("data-tooltip-user-img-url")??"",handle:e.getAttribute("data-tooltip-user-handle")??l}:void 0,userGroupId:r,userGroup:r?{id:r,name:e.getAttribute("data-tooltip-user-group-name")??l,member_count:parseInt(e.getAttribute("data-tooltip-user-group-member-count")??"0"),preview_members:e.getAttribute("data-tooltip-user-group-preview-members")?.split(",")??[],type:K.pR}:void 0})}}function W({displayText:e,userId:t,profileId:n,userAnnotated:r,userGroupId:l,userGroup:i}){let s=new U(e,t,n,r,(0,g.kc)().user_groups_at_mentions?l:void 0,(0,g.kc)().user_groups_at_mentions?i:void 0);return s.setMode("token"),(0,S.pT)(s)}let G={bold:{k63SB2:"x1s688f",$$css:!0},italic:{kKX8nH:"x1k4tb9n",$$css:!0},strikethrough:{kybGjl:"xmqliwb",k1TLXF:null,kMnn75:null,kmVMDM:null,kNySMw:null,$$css:!0},listOl:{kmVPX3:"x1717udv",kg3NbH:null,kuDDbn:null,kE3dHu:null,kP0aTx:null,kpe85a:null,k8WAf4:null,kLKAdn:null,kGO01o:null,kogj98:"x1ghz6dp",kUOVxO:null,keTefX:null,koQZXg:null,k71WvV:null,km5ZXQ:null,kqGvvJ:null,keoZOQ:null,k1K539:null,kpqbRz:"x43c9pm",kH6xsr:"x3yw8vx",$$css:!0},listUl:{kmVPX3:"x1717udv",kg3NbH:null,kuDDbn:null,kE3dHu:null,kP0aTx:null,kpe85a:null,k8WAf4:null,kLKAdn:null,kGO01o:null,kogj98:"x1ghz6dp",kUOVxO:null,keTefX:null,koQZXg:null,k71WvV:null,km5ZXQ:null,kqGvvJ:null,keoZOQ:null,k1K539:null,kpqbRz:"x43c9pm",kH6xsr:"xtaz4m5",$$css:!0},listItem:{koQZXg:"x400o59",keTefX:null,k71WvV:null,$$css:!0}},X={text:{bold:h.Ay.classNames(G.bold),italic:h.Ay.classNames(G.italic),strikethrough:h.Ay.classNames(G.strikethrough)},list:{ol:h.Ay.classNames(G.listOl),ul:h.Ay.classNames(G.listUl),listitem:h.Ay.classNames(G.listItem)}};function $({editorState:e,editorType:t,editable:n}){return{editorState:e,editable:n,namespace:"lexical-editable-typeahead",onError(e){throw e},theme:X,html:{import:{span:()=>({conversion:z,priority:1})}},nodes:[S.Ey,M,U,P,N,{replace:I.Db,with:e=>R(e.__url,{editorType:t}),withKlass:P},{replace:I.k_,with:e=>F(e.__url,{editorType:t}),withKlass:N},D.v5,D.YW]}}function z(e){return{forChild:function(e){let t=e.fontWeight,n=parseInt(t,10),r=e.textDecoration.split(" "),l=isNaN(n)?"bold"===t:n>=600,i=r.includes("line-through"),s="italic"===e.fontStyle;return e=>((0,S.kF)(e)&&(l&&!e.hasFormat("bold")&&e.toggleFormat("bold"),i&&!e.hasFormat("strikethrough")&&e.toggleFormat("strikethrough"),s&&!e.hasFormat("italic")&&e.toggleFormat("italic")),e)}(e.style),node:null}}var B=n(68772),H=n(353859),Z=n(99185),Y=n(118889),V=n(751501),Q=n(557554);let ee={b:"bold",i:"italic",s:"strikethrough"};function et(e){let t=[];return e.read(()=>{let e=(0,S.Ni)();!function(e){let t=e.getChildren();if(1!==t.length)return!1;let n=t[0];return(0,S.bS)(n)&&0===n.getChildren().length}(e)&&e.getChildren().forEach(e=>(function e(t,n){if((0,D.HY)(t)){let r=t.getListType(),l=[];t.getChildren().forEach(t=>{e(t,l)}),er({styles:["number"===r?"ol":"ul"],children:l},n)}else if((0,D.Mz)(t)){let r=[];t.getChildren().forEach(t=>{e(t,r)}),er({children:r},n)}else if((0,S.bS)(t)){let r=n[n.length-1];r&&!ei(r)&&er({t:"\n"},n);let l=t.getChildren();l.length?l.forEach(t=>e(t,n)):er({t:""},n)}else if(t instanceof U){let e=t.getUserId(),r=t.getProfileId(),l=t.getUserAnnotated(),i=t.getUserGroupId(),s=t.getUserGroup(),o={};r?(o.profile_id=r,o.t=t.getMessageMetaText()):(0,g.kc)().user_groups_at_mentions&&i&&s?(o.user_group_id=i,o.user_group=s):e&&l&&(o.user_id=e,o.user_annotated=l),er(o,n)}else if(t instanceof M)er({t:t.getShortcode()},n);else if(t instanceof N||q(t)){let e=t.getURL();er({t:(0,Z.F)(t.getTextContent())??"",link:e},n)}else if((0,S.kF)(t)){let e=(0,Z.F)(t.getTextContent())??"",r=function(e){let t=[];for(let[n,r]of Object.entries(ee))e.hasFormat(r)&&t.push(n);return t}(t),l={t:e};r.length>0&&(l.styles=r),er(l,n)}else(0,S.wH)(t)&&er({t:"\n"},n)})(e,t))}),t}function en(e,t){let n=(0,B.D)({nodes:$({editorState:null,editorType:"headless-editor"}).nodes,onError:e=>{console.error("Error creating Lexical EditorState:",e)}});return n.update(()=>{let n=(0,S.Ni)();n.clear(),function e(t,n,r){let l=(0,V.lZ)(t),i=r;for(let t of l){if(t.children&&t.children.length>0){let l;if(ei(t)){let e=el(t)?"bullet":"number";l=(0,D.DE)(e)}else l=(0,D.i)();r.append(l),e(t.children,n,l),i=r;continue}if((0,S.hV)(i)&&(i=(0,S.lJ)(),r.append(i)),t.user_annotated||t.profile_id||t.user_group_id)(function(e,t){let n;let r=(0,Z.F)(e.t)??"";if(e.profile_id){let t=r.startsWith("@")?r:`@${r}`;n=W({profileId:e.profile_id,displayText:t})}else if(e.user_id&&e.user_annotated){let t=(0,Z.F)(e.user_annotated.handle)??"";n=W({userId:e.user_id,userAnnotated:e.user_annotated,displayText:t})}else if((0,g.kc)().user_groups_at_mentions&&e.user_group_id&&e.user_group){let t=(0,Z.F)(e.user_group.name)??"";n=W({userGroupId:e.user_group_id,userGroup:e.user_group,displayText:t})}else{let e=(0,S.sT)(r);t.append(e);return}t.append(n)})(t,i);else if(t.link&&(0,Q.$x)((0,Y.xT)(t.link)))(function(e,t,n){if(!e.link||!(0,Q.$x)((0,Y.xT)(e.link)))return;let r=(0,Z.F)(e.t)??"",l=R(e.link,{editorType:n}),i=(0,S.sT)(r);es(i,e),l.append(i),t.append(l)})(t,i,n);else if(null!=t.t){let e=(0,Z.F)(t.t)??"";if((0,H.Lg)(e))(function(e,t,n){for(let r of(0,H.wd)(e)){let e="",l="";if((0,H.xM)(r)){(0,H.UF)(r).forEach(t=>{e+=t.unicode,l+=t.meta});let t=O(e,l);n.append(t)}else{let e=(0,S.sT)(r);es(e,t),n.append(e)}}})(e,t,i);else{let n=(0,S.sT)(e);es(n,t),i.append(n),e.endsWith("\n")&&(n.setTextContent(e.slice(0,-1)),i=(0,S.lJ)(),r.append(i))}}}if((0,S.hV)(r)&&!r.getChildren().length){let e=(0,S.lJ)();r.append(e)}}(e,t,n)},{discrete:!0}),n.getEditorState()}function er(e,t){if(null!=e.t){let n=t[t.length-1];n?.t!=null&&1===Object.keys(n).length&&1===Object.keys(e).length?n.t+=e.t:t.push(e)}else t.push(e)}function el(e){return Array.isArray(e.styles)&&e.styles.includes("ul")}function ei(e){return el(e)||Array.isArray(e.styles)&&e.styles.includes("ol")}function es(e,t){if(t.styles&&t.styles.length>0)for(let n of t.styles){let t=ee[n];t&&e.toggleFormat(t)}}let eo=[(0,s.o)(/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,e=>{let t=e.replace(/[-.+():%]+$/,"");return t.startsWith("http")?t:`https://${t}`})];function eu(e){return(0,Q.$x)(e)&&Q.oh.test(e)}function ea(e,t,n){let r=R(e,{editorType:n}),l=(0,S.sT)(t);return r.append(l),r}function ed(){let e=(0,S.vJ)();if(!(0,S.I2)(e))return null;let t=e.getNodes().filter(e=>!em(e));if(t.length<1)return null;let n=ec(t[0]);return n&&t.every(e=>ec(e)===n)?n:null}function ec(e){return q(e)?e.getURL():q(e.getParent())?e.getParent().getURL():null}function ep(e,t,n){let r="next"===n?eh:eg,l=[],i=r(e,q);for(;i&&ey(i,t);)"next"===n?l.push(i):l.unshift(i),i=r(i,q);return l}function ef(e){if(!ed())return;let t=e.getNodes(),n=t[0],r=t[t.length-1];if(!n||!r)return;let l=ec(n);if(!l)return;let i=ep(n,l,"previous"),s=ep(r,l,"next"),o=[...i,...t.map(e=>(function(e,t){if(ey(e,t))return e;let n=e?.getParent();return n&&ey(n,t)?n:null})(e,l)).filter(e=>null!==e),...s],u=o[0],a=o[o.length-1];if(!u||!a)return;let d=e.clone();d.anchor.set(u.getKey(),0,"element"),d.focus.set(a.getKey(),a.getTextContentSize?.()||0,"element"),(0,S.n1)(d)}function em(e){return(0,S.bS)(e)||(0,D.HY)(e)||(0,D.Mz)(e)}function eg(e,t){return e_(e,t,"previous")}function eh(e,t){return e_(e,t,"next")}function e_(e,t,n){let r=null,l=e;for(r=ex(l,n);!r&&l;)r=ex(l=l.getParent(),n);return r&&t(r=function e(t,n){return t&&em(t)?e("next"===n?t.getFirstChild():t.getLastChild(),n):t}(r,n))?r:null}function ex(e,t){return e?"next"===t?e.getNextSibling():e.getPreviousSibling():null}function ey(e,t){return q(e)&&e.getURL()===t}var eb=n(493083),ek=n(187549);function ev(){let[e]=(0,eb.DF)();return(0,r.jsx)(ek.G,{editor:e})}var eC=n(527965),eT=n(128146),eE=n(19512),eA=n(630356),eI=n(977626),eD=n(26194);function eS({anchorNode:e,replacementNode:t,end:n,matchText:r,selection:l,start:i}){let s=l.anchor.offset===e.getTextContent().length;for(let l of e.splitText(i,n))l.getTextContent()===r&&(l.replace(t),t.selectEnd());s&&ej()}function ej(){let e=(0,S.vJ)();(0,S.I2)(e)&&e.insertText(" ")}var ew=n(502040);function eN(e,t=!0){setTimeout(()=>{e.focus(),t&&e.update(()=>{(0,S.Ni)().selectEnd()})},0)}var eF=n(379141),eM=n(888903);let eO=(0,S.gu)();var eL=n(750514);function eP({dispatch:e,onUpdateTextArea:t}){let[n]=(0,eb.DF)(),r=(0,l.useRef)(null);return(0,l.useEffect)(()=>n.registerUpdateListener(({editorState:n})=>{n.read(()=>{let n=(0,S.vJ)();if((0,S.I2)(n)){let l=n.anchor.getNode();if(l instanceof S.Ey){let i=l.getTextContent(),s=n.anchor.offset,o=i.substring(0,s).match(eD.n);if(o){let n=o[1];if(n!==r.current){r.current=n;let l=(0,eL.oQ)(n);l?(e(C.We(l)),t()):e(C.We(null))}}else null!==r.current&&(r.current=null,e(C.We(null)))}else null!==r.current&&(r.current=null,e(C.We(null)))}})}),[n,e,t]),null}function eR(e){return ew.sY?e.metaKey:e.ctrlKey}function eq(e,t){if((0,D.Mz)(e)){let n=e.getParent();if((0,D.HY)(n))return n.getListType()===t}let n=e.getParent();if((0,D.Mz)(n)){let e=n.getParent();if((0,D.HY)(e))return e.getListType()===t}return!1}function eK({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}){return function({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}){(function({delegateEscapeHandling:e,onEscape:t}){let[n]=(0,eb.DF)();(0,l.useEffect)(()=>e?()=>{}:n.registerCommand(S.Q$,e=>(t(),!0),S.d),[e,n,t])})({delegateEscapeHandling:n,onEscape:e}),function({hasTypeahead:e}){let[t]=(0,eb.DF)();(0,l.useEffect)(()=>(0,ew.Sd)(...[S.UD,S.bb,S.AX,S.JM].map(n=>t.registerCommand(n,eU(e),S.d))),[t,e])}({hasTypeahead:r}),function({hasTypeahead:e}){let[t]=(0,eb.DF)();(0,l.useEffect)(()=>t.registerCommand(S.OX,eU(e),S.d),[t,e])}({hasTypeahead:r}),function({onSubmit:e,submitOnEnter:t}){let[n]=(0,eb.DF)();(0,l.useEffect)(()=>n.registerCommand(S.if,r=>{if(t&&!r?.shiftKey||r&&(r.altKey||r.metaKey))return e(),r?.preventDefault(),!0;let l=(0,S.vJ)();if(!(0,S.I2)(l))return!1;if(null!==r){if((ew.pz||ew.Yw||ew.Dz)&&ew.aT)return!1;r.preventDefault()}return n.dispatchCommand(S.XK,void 0)},S.d),[n,e,t])}({onSubmit:t,submitOnEnter:i}),function(){let[e]=(0,eb.DF)();(0,l.useEffect)(()=>e.registerCommand(S.Wu,()=>{let e=(0,S.vJ)();if(!(0,S.I2)(e))return!1;let t=function(e){let t=e.anchor.getNode();return t===e.focus.getNode()?{node:t,point:e.anchor}:null}(e);if(!t)return!1;let n=function(e){let{node:t,point:n}=e;if((0,D.Mz)(t))return t;let r=t.getParent();return r&&(0,D.Mz)(r)&&0===n.offset?r:null}(t);if(!n)return!1;let r=(0,S.lJ)();if(n.replace(r,!0),0===r.getChildrenSize()){let e=(0,S.sT)("");r.append(e),e.select()}return!0},S.d),[e])}(),function(){let[e]=(0,eb.DF)(),t=(0,l.useCallback)(t=>{let{shiftKey:n,key:r}=t;return!!eR(t)&&!!n&&("x"===r?(t.preventDefault(),t.stopPropagation(),e.dispatchCommand(S.mB,"strikethrough"),!0):"8"===r?(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,S.vJ)();(0,S.I2)(t)&&(eq(t.anchor.getNode(),"bullet")?e.dispatchCommand(D.uS,void 0):e.dispatchCommand(D.q7,void 0))})}(e),!0):"7"===r&&(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,S.vJ)();(0,S.I2)(t)&&(eq(t.anchor.getNode(),"number")?e.dispatchCommand(D.uS,void 0):e.dispatchCommand(D.x,void 0))})}(e),!0))},[e]);(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,eb.DF)(),t=(0,l.useCallback)(t=>{eR(t)&&t.shiftKey&&"u"===t.key&&(t.stopPropagation(),e.dispatchCommand(eO,void 0))},[e]);(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,eb.DF)();(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e){let t=e=>{"Escape"!==e.key&&"Backspace"!==e.key&&e.stopPropagation()};return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}}),[e])}()}({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}),null}function eU(e){return t=>(t.stopPropagation(),!!e()&&(t.preventDefault(),!0))}var eJ=n(955394),eW=n(920675);function eG({contactsAnalytics:e,dispatch:t,onUpdateTextArea:n,mentionables:r,isProtoView:i,figmaEditorType:s}){let[o]=(0,eb.DF)(),u=(0,l.useRef)(null),a=(0,l.useRef)(null),[d]=(0,eJ.A)(async l=>{let o=(async e=>{a.current&&a.current.cancel(),a.current=new eI.qm;try{return{result:await (0,eI.t8)((0,eL.fG)(e,r,!i&&s===eW._Y.DESIGN),a.current),canceled:!1}}catch(e){if(e instanceof eI.cJ)return{result:null,canceled:!0};throw e}})(l);(0,_.Lg)()&&(window.TEST_ONLY_mentionsSearchPending=o);let{result:u,canceled:d}=await o;d||(u?(e.trackQueryResult(u.query,u.mentions.length),t(C.We(u))):t(C.We({type:"mentions",mentions:[],index:0,maxMentions:0,search:l,query:l})),n())},300),c=(0,l.useRef)(d);return c.current=d,(0,l.useEffect)(()=>o.registerUpdateListener(({editorState:e})=>{e.read(()=>{let e=(0,S.vJ)();if((0,S.I2)(e)){let n=e.anchor.getNode();if(n instanceof S.Ey){let r=n.getTextContent(),l=e.anchor.offset,i=r.substring(0,l),s=(0,eI.uT)(i);if(s){let{search:e}=s;e!==u.current&&(u.current=e,c.current(e))}else null!==u.current&&(u.current=null,a.current&&a.current.cancel(),t(C.We(null)))}else null!==u.current&&(u.current=null,a.current&&a.current.cancel(),t(C.We(null)))}})}),[o,t]),null}function eX({contactsAnalytics:e,delegateEscapeHandling:t,dispatch:n,editingComment:i,editorOnClear:s,editorOnInsert:o,editorRef:u,editorType:a,figmaEditorType:d,hasTypeahead:c,isProtoView:p,isThreadCommentOverflowMenuOpen:f,maintainSelectionOnFocus:m,mentionables:h,onCancel:_,onFocus:x,onSubmit:y,onUpdateTextArea:b,setHyperlinkEditorRef:k,setHyperlinkLocation:E,setIsEditorFocused:A,submitOnEnter:I,typeahead:D}){let j=(0,l.useRef)(D);j.current=D;let{insertEmoji:w,insertMention:N,clearTypeahead:F,selectAll:M}=function({contactsAnalytics:e,dispatch:t}){let[n]=(0,eb.DF)(),r=(0,l.useCallback)(e=>{let r=()=>{n.update(()=>{let t=(0,S.vJ)()??(0,S.S1)();if(!(0,S.I2)(t))return;let n=t.anchor.getNode(),r=eT.il.getDefaultSkin(),l=r?`:skin-tone-${r}:`:"";e.skins.length<2&&(l="");let i=`:${e.id}:${l}`,s=(0,H.UF)(i);if(!s||s.length<1)return;let o=O(s[0].unicode,i);if(n instanceof S.Ey){let e=n.getTextContent(),r=t.focus.offset,l=e.substring(0,r).match(eD.n);if(l){let e=l.index;eS({anchorNode:n,replacementNode:o,end:r,matchText:l[0],selection:t,start:e});return}}let u=t.anchor.offset===n.getTextContent().length;t.insertNodes([o]),u&&ej()}),t(C.We(null))};n.getEditorState().read(()=>(0,S.vJ)())?r():n.focus(r)},[t,n]);return{insertEmoji:r,insertMention:function(e,t,n){let r=(0,g.kc)().user_groups_at_mentions;return(0,l.useCallback)((l,i)=>{n.trackResultClicked(i.query,i.index,i.mentions.length,!1),(0,eA.r)(i.query,i,!0),e.update(()=>{let e=(0,S.vJ)()??(0,S.S1)();if(!(0,S.I2)(e))return;let t=e.anchor.getNode(),n="profile_handle"in l,i=(0,T.dH)(l),s=n||i?void 0:l.id,o=n?l.id:void 0,u=n||i?void 0:l,a=i&&r?l.id:void 0,d=i&&r?l:void 0,c=W({displayText:n?`@${l.profile_handle}`:i?l.name:(0,Z.F)(l.handle)??l.id,userId:s,profileId:o,userAnnotated:u,userGroupId:a,userGroup:d});if(t instanceof S.Ey){let n=t.getTextContent(),r=e.focus.offset,l=n.substring(0,r),i=(0,eI.uT)(l);if(i){let n=i.index;eS({anchorNode:t,replacementNode:c,end:r,matchText:`@${i.search}`,selection:e,start:n});return}}e.insertNodes([c]),c.selectEnd()}),"profile_handle"in l&&t((0,eE.Hx)(l)),t(C.We(null))},[n,t,e,r])}(n,t,e),clearTypeahead:(0,l.useCallback)(n=>{e.endSession(n),t(C.We(null))},[e,t]),selectAll:(0,l.useCallback)(()=>{n.focus(()=>{n.update(()=>{let e=(0,S.vJ)();(0,S.I2)(e)&&(0,eC.e1)(e)})})},[n])}}({contactsAnalytics:e,dispatch:n}),L=function(){let[e]=(0,eb.DF)();return(0,l.useCallback)(()=>e.getEditorState().read(()=>{let e=(0,S.vJ)();if(!(0,S.I2)(e))return!1;let{anchor:t,focus:n}=e,r=e.isBackward(),l=r?n:t,i=r?t:n,s=(0,S.Ni)(),o=function(e,t){let n=e.getFirstDescendant(),r=e.getFirstChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(s,l.key),u=function(e,t){let n=e.getLastDescendant(),r=e.getLastChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(s,i.key);return!!o&&!!u&&0===l.offset&&i.offset===((0,S.ff)(u)?u.getChildrenSize():u.getTextContentSize())}),[e])}(),P=function({editingComment:e,editorType:t,hasTypeahead:n,isThreadCommentOverflowMenuOpen:r,onCancel:i}){let s=!r&&!(e&&"comment-editor-reply"===t);return(0,l.useCallback)(()=>{!n()&&s&&i()},[s,n,i])}({editingComment:i,editorType:a,hasTypeahead:c,isThreadCommentOverflowMenuOpen:f,onCancel:_}),{hasFocus:R,handleOnFocus:K,focus:U}=function({contactsAnalytics:e,maintainSelectionOnFocus:t=!1,onFocus:n,setIsEditorFocused:r,typeaheadRef:i}){let[s]=(0,eb.DF)(),o=(0,l.useRef)(!1),u=(0,l.useCallback)(()=>o.current,[]),a=(0,l.useCallback)(()=>(o.current=!0,r(o.current),n(),!1),[n,r]),d=(0,l.useCallback)(()=>{eN(s,!t)},[s,t]),c=(0,l.useCallback)((e=!0)=>{u()||eN(s,e)},[s,u]),p=(0,l.useCallback)(()=>{o.current=!1,r(o.current);let t=i.current;return t?.type==="mentions"&&t.mentions[t.index]&&(e.endSession("input_blurred"),(0,eA.r)(t.query,t,!1)),!1},[e,r,i]);return(0,l.useLayoutEffect)(()=>(o.current=s.getRootElement()===document.activeElement,(0,ew.Sd)(s.registerCommand(S.$7,a,S.Ac),s.registerCommand(S.pF,p,S.Ac))),[s,p,a]),{hasFocus:u,handleOnFocus:d,handleOnBlur:p,focus:c}}({contactsAnalytics:e,maintainSelectionOnFocus:m,onFocus:x,setIsEditorFocused:A,typeaheadRef:j});!function({setHyperlinkLocation:e,setHyperlinkEditorRef:t,editorRef:n}){let[r]=(0,eb.DF)();(0,l.useEffect)(()=>n&&e&&t?r.registerCommand(eO,()=>(r.update(()=>{let r=(0,S.vJ)();(0,S.I2)(r)&&ef(r);let l=(0,V.L5)();l&&(e(l),t(n))}),!0),S.d):()=>{},[r,n,t,e])}({setHyperlinkLocation:E,setHyperlinkEditorRef:k,editorRef:u});let J=function({dispatch:e,editorType:t}){let[n]=(0,eb.DF)();return(0,l.useCallback)(r=>{let l=(0,Y.xT)(r);if(!(0,Q.$x)(l)){e(eM.F.enqueue({message:(0,eF.t)("hyperlink.invalid_link_plain")}));return}n.update(()=>{!function(e,t){let n=(0,S.vJ)();if(!(0,S.I2)(n))return;if(n.isCollapsed()){let r=ea(e,e,t);n.insertNodes([r]);return}let r=new Set;n.getNodes().forEach(e=>{if((0,S.kF)(e)){let t=e.getParent();q(t)?r.add(t):r.add(e)}else q(e)&&r.add(e)});let l=Array.from(r),i=n.anchor,s=n.focus;for(let n=0;n<l.length;n++){let r=l[n];if((0,S.kF)(r)){let o,u;1===l.length?(o=Math.min(i.offset,s.offset),u=Math.max(i.offset,s.offset)):0===n?(o=i.key===r.getKey()?i.offset:s.offset,u=void 0):n===l.length-1&&(o=0,u=i.key===r.getKey()?i.offset:s.offset),function(e,t,n,r,l){let i=e.getTextContent(),s=r??0,o=l??i.length,u=i.slice(0,s),a=i.slice(s,o),d=i.slice(o),c=[];u&&c.push((0,S.sT)(u)),a&&c.push(ea(t,a,n)),d&&c.push((0,S.sT)(d));let[p,...f]=c;p&&(e.replace(p),f.reduce((e,t)=>(t.insertAfter(e),t),p))}(r,e,t,o,u)}else q(r)&&r.setURL(e)}}(l,t)})},[e,n,t])}({dispatch:n,editorType:a}),G=function(){let[e]=(0,eb.DF)();return(0,l.useCallback)(()=>e.read(()=>ed()??""),[e])}(),X=function(){let[e]=(0,eb.DF)();return(0,l.useCallback)(()=>{e.update(()=>{!function(){if(!ed())return;let e=S.vJ()?.getNodes().filter(q);e?.forEach(e=>{!function(e){let t=e.getTextContent(),n=(0,S.sT)(t),r=(0,S.vJ)();e.replace(n),(0,S.I2)(r)&&n.select()}(e)})}()})},[e])}(),$=function({dispatch:e,setHyperlinkLocation:t,setHyperlinkEditorRef:n,editorRef:r}){let[i]=(0,eb.DF)();return(0,l.useCallback)((l,s)=>{t&&n&&r&&(e((0,v.jD)()),i.update(()=>{let e=(0,S.ns)(l);if(!q(e))return;e.select();let i=(0,S.vJ)();(0,S.I2)(i)&&ef(i),s&&(t(s),n(r))}))},[e,i,r,n,t])}({dispatch:n,setHyperlinkLocation:E,setHyperlinkEditorRef:k,editorRef:u});(0,l.useImperativeHandle)(u,()=>({onFocus:K,focus:U,selectAll:M,onSubmitHyperlink:J,onRemoveHyperlink:X,getActiveHyperlinkForCurrentSelection:G,editHyperlinkFromTooltip:$,handleEscape:P,hasFocus:R,isAllSelected:L,insertEmoji:w}),[$,U,G,P,K,X,J,R,w,L,M]);let z=(0,l.useCallback)(()=>{let e=j.current;if(e){if("emojis"===e.type){let t=e.emojis[e.index];t&&w(t)}else if("mentions"===e.type){let t=e.mentions[e.index];t&&N(t,e)}}},[w,N]);return(0,l.useEffect)(()=>{o(z),s(()=>F("editor_clear"))},[F,o,s,z]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eP,{dispatch:n,onUpdateTextArea:b}),(0,r.jsx)(eG,{contactsAnalytics:e,dispatch:n,onUpdateTextArea:b,mentionables:h,isProtoView:p,figmaEditorType:d}),(0,r.jsx)(eK,{onEscape:P,onSubmit:y,delegateEscapeHandling:t,hasTypeahead:c,submitOnEnter:I})]})}function e$(){let[e]=(0,eb.DF)();return(0,l.useEffect)(()=>e.registerNodeTransform(S.Ey,e=>{let t=e.getTextContent(),n=(function(e,t){let n=e.getTextContent(),r=n;if((0,S.I2)(t)&&t.anchor.getNode()===e){let e=t.anchor.offset;r=n.substring(0,e)}return r})(e,(0,S.vJ)()).match(eD.v);if(!n)return;let r=n[0],l=n.index,i=l+r.length;if(!(0,H.xM)(r))return;let s=(0,H.UF)(r);if(null==s||0===s.length)return;let o=O(s[0].unicode,r);switch(function({startOffset:e,endOffset:t,textContent:n}){return 0===e&&t===n.length?"all":0===e?"start":t===n.length?"end":"middle"}({startOffset:l,endOffset:i,textContent:t})){case"all":e.replace(o);break;case"start":{let n=t.slice(i),r=(0,S.sT)(n);e.insertAfter(r),e.replace(o);break}case"end":{let n=t.slice(0,l),r=(0,S.sT)(n);e.insertBefore(r);let i=(0,S.sT)(" ");e.insertAfter(i),e.replace(o),i.select();break}case"middle":{let n=t.slice(0,l),r=t.slice(i),s=(0,S.sT)(n),u=(0,S.sT)(r);e.insertBefore(s),e.insertAfter(u),e.replace(o)}}}),[e]),null}var ez=n(437509);function eB({onFilePaste:e}){let[t]=(0,eb.DF)();return(0,l.useEffect)(()=>t.registerCommand(S.w,t=>{let[,n,r]=(0,ez.gA)(t);return n.length>0&&!r&&(e(n),!0)},S.Ac),[t,e]),null}function eH({initMention:e}){let[t]=(0,eb.DF)(),n=(0,l.useRef)(void 0);return(0,l.useEffect)(()=>{let r=n.current;e&&!r&&t.update(()=>{let e=(0,S.vJ)();(0,S.I2)(e)&&e.insertText("@")}),n.current=e},[t,e]),null}function eZ({maxLength:e}){let[t]=(0,eb.DF)();return(0,l.useEffect)(()=>{let n=null;return t.registerNodeTransform(S.h,r=>{let l=(0,S.vJ)();if(!(0,S.I2)(l)||!l.isCollapsed())return;let i=t.getEditorState(),s=i.read(()=>r.getTextContentSize()),o=r.getTextContentSize();if(s!==o){let r=o-e,u=l.anchor;r>0&&(s===e&&n!==i?(n=i,(0,ew.Xq)(t,i)):(0,eC._A)(t,u,r))}})},[t,e]),null}var eY=n(193507);function eV({messageMeta:e,editorType:t}){let[n]=(0,eb.DF)(),r=(0,b.ZC)(e);return l.useEffect(()=>{if(r&&!(0,eY.Wf)(e,r)){let r=et(n.getEditorState());if(!(0,eY.Wf)(r,e)){let r=en(e,t);n.setEditorState(r),n.focus()}}},[n,e,r,t]),null}var eQ=n(867200);function e0({focusStart:e,shouldAutoFocus:t}){return t?(0,r.jsx)(eQ.x,{defaultSelection:e?"rootStart":"rootEnd"}):null}function e1(){let[e]=(0,eb.DF)();return(0,l.useEffect)(()=>(window.lexicalEditor=e,()=>{delete window.lexicalEditor}),[e]),null}var e2=n(480866),e5=n(756931);let e7=[e2.d7,e2.Pi,e2.Eg,e2.gW,e2.NB,e2.mK,e2.WY];function e4(){return(0,r.jsx)(e5.E,{transformers:e7})}let e3=l.forwardRef(function(e,t){let{ariaLabel:n,className:h,currentOrgId:x,currentOrgUsers:I,delegateEscapeHandling:D,dispatch:j,editingComment:N,editorOnClear:F,editorOnInsert:M,editorRef:O,editorType:L,figmaEditorType:P,initMention:R,isProtoView:q,isThreadCommentOverflowMenuOpen:K,maintainSelectionOnFocus:U,maxCommentLength:J,mentionables:W,messageMeta:G,mountInputFocused:X,moveFocusToStartOnMount:z,onCancel:B,onFilePaste:H,onFocus:Z,onSubmit:Y,onUpdateTextArea:V,openFileKey:Q,openFileTeamId:ee,placeholderText:er,readOnly:el,setHyperlinkEditorRef:ei,setHyperlinkLocation:es,setIsEditorFocused:ea,showDebugger:ed,submitOnEnter:ec,tabIndex:ep,typeahead:ef,updateMessage:em,user:eg}=e,eh=function({messageMeta:e,editorType:t,editable:n}){let[r]=(0,l.useState)(()=>en(e,t));return(0,l.useMemo)(()=>$({editorState:r,editorType:t,editable:n}),[n,t,r])}({messageMeta:G,editorType:L,editable:!el}),e_=function({currentOrgId:e,currentOrgUsers:t,openFileKey:n,openFileTeamId:r,user:i}){return(0,l.useMemo)(()=>{let l=(0,E.Ty)(e??null,i??null,t),s=(0,E.pP)(e,r,l);return new E.yO(E.I2,n,s,e,r,"lexical")},[e,t,n,r,i])}({currentOrgId:x,currentOrgUsers:I,openFileKey:Q,openFileTeamId:ee,user:eg}),ex=function(){let[e]=(0,l.useState)(()=>{let e=["onMouseDown"];return A.eD||e.push("onContextMenu"),e});return e}(),ey=(0,b.ZC)(ef),eb=l.useRef(ef);eb.current=ef;let ek=(0,l.useCallback)(()=>!!eb.current,[]);(0,l.useEffect)(()=>{O&&L&&j(v.pP({targetKey:L,targetRef:O}))},[j,O,L]),(0,l.useEffect)(()=>{ey||ef?.type!=="mentions"||j((0,C.Qe)())},[ey,ef,j]);let eC=(0,l.useCallback)(()=>{(0,g.kc)().comments_click_focus_bug&&!O?.current?.hasFocus()&&O?.current?.onFocus()},[O]);return(0,r.jsx)(k.n.div,{className:y()(w.DX,h||w.DL),"data-testid":"editable-typeahead",onClick:eC,children:(0,r.jsx)(i.o,{eventListeners:ex,children:(0,r.jsxs)(o.n,{initialConfig:eh,children:[(0,r.jsx)(d.G,{}),(0,r.jsx)(m.$,{contentEditable:(0,r.jsx)("div",{className:"x1n2onr6",children:(0,r.jsx)(u.a,{"aria-haspopup":"listbox","aria-placeholder":er??"",ariaActiveDescendant:ef?.type==="mentions"?e.activeMentionsId:void 0,ariaControls:ef?.type==="mentions"?T.Qd:void 0,ariaExpanded:ef?.type==="mentions",ariaLabel:n??er,placeholder:(0,r.jsx)("span",{className:"x3vvef7 x10l6tqk x13vifvy xu96u03 x47corl",children:er}),role:"combobox",tabIndex:ep})}),ErrorBoundary:a.A}),(0,r.jsx)(f.D,{onChange:e=>{em([et(e),e.read(()=>{let e=(0,S.vJ)();if(!(0,S.I2)(e))return!1;let t=(0,S.Ni)(),n=t.getChildren();if(0===n.length)return!1;let r=n[n.length-1],l=n.length>1?n[n.length-2]:null,i=e.getNodes()[e.getNodes().length-1]??e.focus.getNode();for(;i&&i.getParent()!==t;)i=i.getParent();return i===r||null!=l&&i===l})])}}),(0,r.jsx)(e0,{focusStart:!!z,shouldAutoFocus:!!X}),(0,r.jsx)(eV,{messageMeta:G,editorType:L}),(0,r.jsx)(eH,{initMention:R}),null!=J&&J>0&&(0,r.jsx)(eZ,{maxLength:J}),(0,r.jsx)(e$,{}),null!=H&&(0,r.jsx)(eB,{onFilePaste:H}),(0,r.jsx)(eX,{contactsAnalytics:e_,delegateEscapeHandling:D,dispatch:j,editingComment:N,editorOnClear:F,editorOnInsert:M,editorRef:O,editorType:L,figmaEditorType:P,hasTypeahead:ek,isProtoView:q,isThreadCommentOverflowMenuOpen:K,maintainSelectionOnFocus:U,mentionables:W,onCancel:B,onFocus:Z,onSubmit:Y,onUpdateTextArea:V,setHyperlinkEditorRef:ei,setHyperlinkLocation:es,setIsEditorFocused:ea,submitOnEnter:ec,typeahead:ef}),(0,r.jsx)(s.p,{matchers:eo}),(0,r.jsx)(c.W,{validateUrl:eu}),(0,r.jsx)(e4,{}),(0,r.jsx)(p.Q,{}),ed&&(0,r.jsx)(ev,{}),(0,_.Lg)()&&(0,r.jsx)(e1,{})]})})})})},782569:(e,t,n)=>{n.d(t,{n:()=>d});var r=n(239976),l=n(239620),i=n(224542),s=n.n(i),o=n(259714),u=n(236410);let a="file_upload_icon_input--disabledIcon--XWTKK";function d(e){let{svg:t,svgAltText:n,isDisabled:i,acceptedFileTypes:d,inputRef:c,onFileInputChange:p,singleFile:f,recordingKey:m}=e,g=(0,l.AF)(m,"change",e=>{p(c)()});return(0,r.jsxs)("label",{htmlFor:e.inputId,className:s()("file_upload_icon_input--fileUploadIconLabel--4wFdr",{[a]:i}),"data-tooltip-type":u.Ib.TEXT,"data-tooltip-show-immediately":!0,"data-tooltip":i?null:e["data-tooltip"],children:[(0,r.jsx)("input",{ref:c,accept:d,"aria-label":e["data-tooltip"],className:"file_upload_icon_input--fileInput--mYM1i",disabled:i,id:e.inputId,multiple:!f,name:e.inputId,onChange:g,type:"file"}),e.children||t&&(0,r.jsx)("div",{className:"file_upload_icon_input--svg--uTtlT",children:(0,r.jsx)(o.B,{title:n,ariaLabel:n,svg:t,autosize:!0,className:s()({[a]:i})})})]})}}}]);

//# debugId=d9bc37d5-c94a-5843-ae12-c08c65630549

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/e0f267e6f9c16b56d2dd93d4186f823c54b33c15/7597-a1a3940aca59ed0c.min.js.map